# Layer: A11y (Accessibility & Inclusive Design)

Comprehensive accessibility and visual design review covering WCAG 2.1 and 2.2, modern HTML semantics, and visual design fundamentals. The goal: interfaces that work for everyone, regardless of ability, device, or context.

**Layer ID:** `a11y`
**Default:** On (always active unless explicitly disabled)
**Applies to:** All platforms (web-first examples, concepts translate)

---

## Accessibility Checks — WCAG 2.1

### Critical (Must Fix)

| ID | Check | WCAG | What to Look For |
|----|-------|------|------------------|
| A1 | Missing image descriptions | 1.1.1 | `<img>` without `alt`. Decorative images need `alt=""`. Informative images need meaningful text. |
| A2 | Unnamed interactive controls | 4.1.2 | Buttons or links containing only an icon (SVG, emoji, image) with no `aria-label` or visually-hidden text to announce their purpose. |
| A3 | Unlabeled form fields | 1.3.1 | `<input>`, `<select>`, `<textarea>` without a visible `<label>`, `aria-label`, or `aria-labelledby`. Placeholder alone is not a label. |
| A4 | Non-keyboard-accessible handlers | 2.1.1 | `<div onClick>` or `<span onClick>` — a non-interactive element used as a button without `role="button"`, `tabIndex={0}`, and a key event handler. |
| A5 | Broken link semantics | 2.1.1 | `<a>` missing `href`, relying only on `onClick`. Screen readers and keyboards cannot interact with it as a link. |

### Serious (Should Fix)

| ID | Check | WCAG | What to Look For |
|----|-------|------|------------------|
| A6 | Removed focus indicator | 2.4.7 | `outline-none` or `outline: 0` applied without a replacement visible indicator like `focus-visible:ring-*`. |
| A7 | Missing keyboard interaction | 2.1.1 | Elements with `onClick` that lack corresponding `onKeyDown`/`onKeyUp` handlers for Enter/Space activation. |
| A8 | Color as sole differentiator | 1.4.1 | Status, state, or category conveyed only by color — no accompanying icon, pattern, or text label. |
| A9 | Undersized touch/click targets | 2.5.5 | Interactive elements with a tappable area smaller than 44×44px. Check `min-h-11 min-w-11` or equivalent padding. |
| A10 | Insufficient text contrast | 1.4.3 | Text-to-background contrast below 4.5:1 for normal text or 3:1 for large text (≥18px, or ≥14px bold). |
| A11 | Page language not declared | 3.1.1 | HTML document missing `lang` attribute on `<html>`, preventing screen readers from selecting the correct pronunciation engine. |
| A12 | Vague or generic link text | 2.4.4 | Links reading "click here", "read more", "learn more" without surrounding context. Link text should describe its destination. |

### Moderate (Consider Fixing)

| ID | Check | WCAG | What to Look For |
|----|-------|------|------------------|
| A13 | Broken heading hierarchy | 1.3.1 | Heading levels skipped (e.g., h1 directly to h3). Headings form an outline — skipping levels breaks navigation for screen reader users. |
| A14 | Positive tabIndex values | 2.4.3 | `tabIndex` > 0 forces an element out of natural DOM order. Disrupts predictable keyboard navigation. Use 0 or -1 only. |
| A15 | Incomplete ARIA roles | 4.1.2 | `role="button"` without matching `tabIndex={0}` and keyboard handler, or `role="checkbox"` without `aria-checked`. |
| A16 | Animations ignore motion preferences | 2.3.3 | CSS animations or JS transitions that run regardless of `prefers-reduced-motion`. Use Tailwind `motion-safe:` or a media query. |
| A17 | Missing live region announcements | 4.1.3 | Dynamic content updates (toasts, status messages, live counters) that appear visually but are not announced — needs `aria-live="polite"` or `"assertive"`. |
| A18 | No skip navigation link | 2.4.1 | Pages with substantial navigation but no "Skip to content" link for keyboard users to bypass repetitive elements. |
| A19 | Missing autocomplete on identity fields | 1.3.5 | Name, email, phone, address, and payment fields without `autocomplete` attribute. Assists password managers and autofill for motor-impaired users. |
| A20 | Missing page title | 2.4.2 | Document without a meaningful `<title>`, or with a generic title like "Untitled" or "Page". Title is the first thing announced by screen readers. |

---

## Accessibility Checks — WCAG 2.2

New criteria from WCAG 2.2 (W3C Recommendation, October 2023).

| ID | Check | WCAG | What to Look For |
|----|-------|------|------------------|
| A21 | Accessible authentication | 3.3.8 | Login flows that require cognitive function tests (CAPTCHAs, puzzles, memorizing passwords) without providing an alternative mechanism like passkeys, copy-paste support, or password manager compatibility. |
| A22 | Redundant entry | 3.3.7 | Multi-step forms that ask the user to re-enter information already provided in a previous step (e.g., re-typing email on confirmation page). Pre-populate or allow auto-fill. |
| A23 | Consistent help location | 3.2.6 | Help mechanisms (contact info, chat widget, FAQ link) that appear on multiple pages but in different locations. Help should be in a consistent position across the site. |
| A24 | Dragging requires an alternative | 2.5.7 | Functionality that can only be accomplished by dragging (reorder, resize, draw) without a non-dragging alternative (buttons, keyboard shortcuts, or click-to-place). |

---

## Modern HTML Patterns

Prefer native platform capabilities over custom implementations. These reduce JavaScript, improve accessibility by default, and are better supported by assistive technology.

| ID | Check | Severity | What to Look For |
|----|-------|----------|------------------|
| M1 | Custom modal instead of `<dialog>` | Suggestion | Hand-built modals using divs + portals + focus traps. Native `<dialog>` with `showModal()` provides focus trapping, Escape dismissal, and `::backdrop` styling for free. |
| M2 | Missing `inert` on background content | Warning | When a modal or overlay is open, background content remains interactive. Apply the `inert` attribute to non-modal content so keyboard and screen readers cannot reach it. |
| M3 | Custom tooltip/popover ignoring Popover API | Suggestion | Hand-built popovers using absolute positioning and show/hide state. The Popover API (`popover` attribute + `popovertarget`) handles dismissal, stacking, and accessibility natively. |
| M4 | CSS visual order diverges from DOM order | Warning | Using CSS `order`, `flex-direction: row-reverse`, or grid placement that causes the visual reading order to differ significantly from the DOM source order. Screen readers and keyboard users follow DOM order. |

---

## Visual Design Checks

### Layout & Spacing

| ID | Check | Severity | What to Look For |
|----|-------|----------|------------------|
| V1 | Inconsistent spacing within a component level | Warning | Cards at the same hierarchy use different padding (e.g., some `p-4`, others `p-6`). Same-level elements should share spacing. |
| V2 | Content breaking container bounds | Warning | Text or elements overflowing their parent without scroll handling or truncation. |
| V3 | Misaligned elements in a flex/grid container | Warning | Visual misalignment caused by inconsistent sizing, missing alignment properties, or mixed content heights. |
| V4 | Z-index stacking conflicts | Warning | Overlays, dropdowns, or tooltips layered incorrectly due to competing z-index values or missing stacking contexts. |
| V5 | Content fails to reflow at 320px viewport | Warning | Page content that requires horizontal scrolling at 320px CSS width (WCAG 1.4.10). Layouts should reflow to a single column. |

### Typography

| ID | Check | Severity | What to Look For |
|----|-------|----------|------------------|
| V6 | Unauthorized font families | Warning | Font families not declared in the active aesthetic preset. |
| V7 | Inconsistent weight assignments | Warning | Same-level headings using different weights across the page (e.g., some h2 bold, others semibold). |
| V8 | Cramped line height on body text | Warning | Body text using `leading-tight` or `leading-none` — reduces readability for extended reading. |
| V9 | No font fallback stack | Suggestion | Custom fonts loaded without a system font fallback in the font-family declaration. |
| V10 | Text spacing intolerance | Warning | Layout that breaks when users apply custom text spacing (WCAG 1.4.12): line-height 1.5×, paragraph spacing 2×, letter-spacing 0.12em, word-spacing 0.16em. |

### Color & Contrast

| ID | Check | Severity | What to Look For |
|----|-------|----------|------------------|
| V11 | Missing interactive state feedback | Warning | Buttons, links, or clickable elements without visible hover, active, or focus state changes. |
| V12 | Dark mode inconsistencies | Warning | Components that visually break or become unreadable when the color scheme switches. |

### Component States

| ID | Check | Severity | What to Look For |
|----|-------|----------|------------------|
| V13 | Incomplete button states | Warning | Buttons missing disabled, loading, hover, active, or focus styles. |
| V14 | Incomplete form field states | Warning | Form inputs without error, success, or disabled visual treatments. |
| V15 | Inconsistent elevation/border treatment | Suggestion | Cards or containers at the same level using a mix of border styles and shadow depths. |
| V16 | Inconsistent icon sizing | Suggestion | Icons at different sizes within the same visual context (e.g., 16px and 20px icons in the same toolbar). |

### Error Messaging

| ID | Check | Severity | What to Look For |
|----|-------|----------|------------------|
| V17 | Vague error messages | Warning | Error text like "Something went wrong" or "Invalid input" without explaining what specifically failed and how to fix it. |
| V18 | Error message far from its field | Warning | Form validation errors displayed in a summary banner at the top of the form rather than inline next to the relevant field. Both is ideal; only summary is insufficient. |

---

## Guard Checks (for inline guard during work phase)

When the a11y layer is active, these checks run silently during coding:

**Errors (block and explain):**
- A1-A5: Critical accessibility violations — always flag before writing code
- A9-A10: Touch targets and contrast — measurable, non-negotiable

**Warnings (flag in response):**
- A6-A8, A11-A12: Serious accessibility issues
- A21-A24: WCAG 2.2 compliance
- M2, M4: Modern HTML patterns that affect accessibility
- V1-V5, V7-V8, V10-V14, V17-V18: Visual quality and usability issues

**Suggestions (mention if teaching mode allows):**
- A13-A20: Moderate accessibility improvements
- M1, M3: Modern HTML patterns that improve DX
- V6, V9, V15-V16: Polish items

---

## Teaching Moments

### Touch Targets
> "This interactive element is `{size}` ({pixels}px) — WCAG 2.5.5 requires a minimum 44×44px target area. Add `min-h-11 min-w-11` or increase padding to ensure the target is large enough for touch and pointer users."

### Accessible Names
> "This icon-only button has no accessible name. Screen readers will announce it simply as 'button' with no context. Add `aria-label=\"{suggested-label}\"` to describe the action it performs."

### Color as Sole Differentiator
> "Status is communicated only through color here. Approximately 1 in 12 men and 1 in 200 women have color vision deficiency. Pair the color with an icon, pattern, or text label: {suggestion}."

### Semantic Interactive Elements
> "This `<div onClick>` is invisible to keyboard navigation. Users tabbing through the page will skip it entirely. Use a `<button>` element (preferred for actions) or add `role=\"button\"`, `tabIndex={0}`, and an `onKeyDown` handler."

### Contrast Ratios
> "The contrast between `{foreground}` on `{background}` is approximately {ratio}:1. WCAG AA requires 4.5:1 for normal text and 3:1 for large text (18px+ or 14px bold+). Try `{suggestion}` for sufficient contrast."

### Respecting Motion Preferences
> "This animation runs for all users. People with vestibular disorders can experience nausea or dizziness from motion. Wrap in `@media (prefers-reduced-motion: no-preference)` or use Tailwind's `motion-safe:` prefix to respect user settings."

### Native Dialog Element
> "This custom modal reimplements focus trapping and backdrop handling. The native `<dialog>` element with `showModal()` provides focus trapping, Escape-to-close, and `::backdrop` styling built-in — less code, better accessibility."

### Page Language
> "The `<html>` element is missing a `lang` attribute. Without it, screen readers may use the wrong pronunciation engine, making content unintelligible. Add `lang=\"{language-code}\"` (e.g., `lang=\"en\"`)."

### Link Text Quality
> "The link text '{link-text}' does not describe where it leads. Screen reader users often navigate by listing all links on a page — each link should make sense out of context. Try: '{suggestion}'."

### Accessible Authentication
> "This login form requires memorization of a password without supporting paste or password managers. WCAG 2.2 (3.3.8) requires that authentication not depend on cognitive function tests. Ensure the password field allows paste and is compatible with credential managers."

---

## Standalone Output Format

When invoked via `/a11y` (standalone accessibility audit), use this format:

```
═══════════════════════════════════════════════════
A11Y DESIGN REVIEW: [filename]
═══════════════════════════════════════════════════

CRITICAL (X issues)
───────────────────
[A11Y] Line NN: Description
  <code snippet>
  Fix: Specific fix
  WCAG: X.X.X

SERIOUS (X issues)
──────────────────
[A11Y] Line NN: Description
  <code snippet>
  Fix: Specific fix
  WCAG: X.X.X

MODERATE (X issues)
───────────────────
...

WCAG 2.2 (X issues)
────────────────────
...

MODERN HTML (X issues)
──────────────────────
...

VISUAL (X issues)
─────────────────
[VISUAL] Line NN: Description
  Fix: Specific fix

═══════════════════════════════════════════════════
SUMMARY: X critical, X serious, X moderate, X visual
A11y Score: XX/100
═══════════════════════════════════════════════════
```

When invoked as part of `/design-review` (composite audit), the output is integrated into the composite score as the **Accessibility** sub-score.
